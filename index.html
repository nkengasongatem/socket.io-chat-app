<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <title>WebSockets | Node.js</title>
    <style>
        div#log {
            width:800px;
            height: 300px;
            margin: 0 auto;
            border: 5px solid black;
            border-radius: 7px;
        }
        div#sendControls {
            width: 235px;
            margin: 30px auto;
        }
    </style>
</head>

<body>
    
     <div id="log"></div>
        
    <div id="sendControls">
        <input type="text" placeholder="Your message here" id="text">
        <button>Send</button><br><br>
    </div>

    <script>
        let name = prompt("What is your name ?");

        let socket = new WebSocket("ws://localhost:5001");
        socket.onopen = function() {
            socket.send(JSON.stringify({
                type: "name",
                data:  name
            }));
        }

        let log = document.getElementById('log');

        socket.onerror = function(event){
            // create  toast or console.log the error
            console.log("Sorrry an error occured");
        }
        socket.onmessage = function(event){
            console.log(event);
            let json = JSON.parse(event.data);
            log.innerHTML += json.name + ": " + json.data + "<br>";
        };
        
        document.querySelector('button').onclick = function() {
            let text = document.getElementById('text').value;
            // sock.send(text);
            socket.send(JSON.stringify({
                type: "message",
                data:  text
            }));
            log.innerHTML += "You: " + text + "<br>";
        }
    </script>
</body>

</html>